  # ══════════════════════════════════════════════════════════════════════════════
  # ADGUARD HOME (DNS & AdBlock)
  # Internal IP: 10.0.0.100
  # ══════════════════════════════════════════════════════════════════════════════
services:
  adguard:
    image: adguard/adguardhome:latest
    container_name: adguard_home
    restart: unless-stopped
    networks:
      vpn_net:
        ipv4_address: 10.0.0.100
    environment:
      - PUID=1000   # Change if your user ID is different
      - PGID=1000   # Change if your group ID is different
      - TZ=Europe/Bratislava
    volumes:
      - ${PWD}/config:/opt/adguardhome/conf/
    ports:
#      - "53:53/tcp"
#      - "53:53/udp"
      # Web UI bound to localhost for Pangolin Proxy
      - "127.0.0.1:8080:80/tcp"
      - "127.0.0.1:3000:3000/tcp"
    cap_add:
      - NET_ADMIN
    security_opt:
      - no-new-privileges:true
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  # ══════════════════════════════════════════════════════════════════════════════
  # WG-EASY (VPN Server)
  # Internal IP: 10.0.0.200
  # ══════════════════════════════════════════════════════════════════════════════
  wg-easy:
    image: ghcr.io/wg-easy/wg-easy
    container_name: wg-easy
    restart: unless-stopped
    depends_on:
      - adguard
    networks:
      vpn_net:
        ipv4_address: 10.0.0.200
    environment:
      - WG_HOST=37.9.170.96
      - PASSWORD_HASH=$$2a$$10$$8U89a.FbvnYM4.5XqkZZf.XuUogqJ9Zx1hQRePOPPU1IGmnBJgRy2
      
      # ⚠️ VPN Tunnel IPs (Clients get 10.8.0.2, 10.8.0.3, etc.)
      # This MUST be different from the Docker network (10.0.0.x)
      - WG_DEFAULT_ADDRESS=10.8.0.x
      
      # Point clients to AdGuard's new static IP
      - WG_DEFAULT_DNS=10.0.0.100
      
      - WG_ALLOWED_IPS=0.0.0.0/0, ::/0
    volumes:
      - ${PWD}/wg-easy:/etc/wireguard
    ports:
      - "51820:51820/udp"           # Public VPN port
      - "127.0.0.1:51821:51821/tcp" # Web UI bound to localhost for Pangolin
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.src_valid_mark=1
    security_opt:
      - no-new-privileges:true
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

# ══════════════════════════════════════════════════════════════════════════════
# NETWORK CONFIGURATION
# ══════════════════════════════════════════════════════════════════════════════
networks:
  vpn_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.0.0.0/24
          gateway: 10.0.0.1
